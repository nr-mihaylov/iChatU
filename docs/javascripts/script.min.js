function animateCSS(e,t,n){var i="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";$(e).addClass("animated").addClass(t).one(i,function(){$(this).removeClass("animated").removeClass(t),n&&n(this)})}function CustEvent(){var e=[];return{addListener:function(t){e.push(t)},removeListener:function(t){for(var n=0;n<e.length;n++){t===e[n]&&e.splice(n,1);break}},removeAllListeners:function(){e.splice(0,e.length)},emit:function(t){if(e.length>0)for(var n=0;n<e.length;n++)e[n](t)}}}function InputVault(e){var t=[],n=null;return{addRecord:function(i){t.push(i),n=t.length,t.length>e&&(t=t.slice(1,e+1))},getRecord:function(e){return n=e?--n:++n,0===t.length?"":(n<0&&(n=t.length-1),n>t.length-1&&(n=0),t[n])}}}function ichatLogo(e){function t(){$(i).css("font-size",$(n).height()/2)}var n=e+" .logo__img",i=e+" .logo__text";t(),$(window).resize(t)}function BlinkCursor(e){return id=null,{start:function(){var t=$(e);t&&(id=setInterval(function(){var e=t.text(),n=e.slice(e.length-1,e.length);"_"===n?t.text(e.slice(0,e.length-1)):t.text(t.text()+"_")},600))},stop:function(){id&&clearInterval(id)}}}function ichatuFold(e){var t=new CustEvent,n=new CustEvent;return{collapse:function(n){animateCSS(e,n,function(e){$(e).hide(),t.emit()})},expand:function(t){$(e).show(),animateCSS(e,t,function(e){n.emit()})},onCollapseEnd:{addListener:t.addListener,removeListener:t.removeListener,removeAllListenerse:t.removeAllListenerse},onExpandEnd:{addListener:n.addListener,removeListener:n.removeListener,removeAllListenerse:n.removeAllListenerse}}}function SectionSwitch(e,t){if(!e)throw new Error("ReferenceError: missing container argument");t=t||{},t.itemSelec=t.itemSelec||">*",t.visibleSelec=t.visibleSelec||"switch--visible",t.hiddenSelec=t.hiddenSelec||"switch--hidden";for(var n=$(e+" "+t.itemSelec),i=0;i<n.length;i++){if($(n[i]).hasClass(t.visibleSelec))var o=n[i];else $(n[i]).hasClass(t.hiddenSelec)||$(n[i]).addClass(t.hiddenSelec);$(n[i]).attr("id","switch"+i)}var r=!1;return{switch:function(e,n,i){r||(r=!0,animateCSS(o,n,function(n){$(n).removeClass(t.visibleSelec).addClass(t.hiddenSelec),$(e).removeClass(t.hiddenSelec).addClass(t.visibleSelec),animateCSS(e,i,function(t){o=$(e),r=!1})}))}}}function ichatuForm(e,t){function n(e){for(var t={},n=0;n<d.length;n++)t[$(d[n]).attr("name")]=$(d[n]).val();return t}function i(){var n=$(window).width(),i=$(window).height();n<t.adjustBreakpoint&&i<t.adjustBreakpoint&&n>i?$(e).addClass(t.alternateModSelec):$(e).removeClass(t.alternateModSelec)}t=t||{},t.adjustBreakpoint=t.adjustBreakpoint||768,t.alternateModSelec=t.alternateModSelec||"form--alternate";var o=e+" .form__field",r=e+" .form__validation",a=e+" .form__submit",s=e+" .form__cancel",l=new CustEvent,u=new CustEvent,d=$(o);return $(e).keypress(function(e){13===e.keyCode&&l.emit({data:n($(o))})}),$(a).click(function(){l.emit({data:n($(o))})}),$(s).click(function(){u.emit()}),i(),$(window).resize(i),{setValidationText:function(e){$(r).text(e)},onSubmit:{addListener:l.addListener,removeListener:l.removeListener,removeAllListenerse:l.removeAllListenerse},onCancel:{addListener:u.addListener,removeListener:u.removeListener,removeAllListenerse:u.removeAllListenerse}}}function ichatuStatusbar(e){var t=$(e+" #status_beat"),n=$(e+" #info_btn img"),i=new CustEvent,o=new CustEvent;return{statusBeat:$(t),infoBtn:$(n),collapse:function(t){animateCSS(e,t,function(e){$(e).hide(),i.emit()})},expand:function(t){$(e).show(),animateCSS(e,t,function(e){o.emit()})},statusOn:function(){$(t).removeClass("statusbar__item--off").addClass("statusbar__item--on")},statusOff:function(){$(t).removeClass("statusbar__item--on").addClass("statusbar__item--off")},onCollapseEnd:{addListener:i.addListener,removeListener:i.removeListener,removeAllListenerse:i.removeAllListenerse},onExpandEnd:{addListener:o.addListener,removeListener:o.removeListener,removeAllListenerse:o.removeAllListenerse}}}function ichatuSidebar(e,t){t=t||{},t.adjustBreakpoint=t.adjustBreakpoint||1200;var n=e+" .sidebar__header",i=e+" .sidebar__body",o=new CustEvent,r=new CustEvent,a=0,s=!1;return $(window).resize(function(){$(window).width()>t.adjustBreakpoint?$(e).show():s||$(e).hide()}),{collapse:function(t){s=!1,animateCSS(e,t,function(e){$(e).hide(),o.emit()})},expand:function(t){s=!0,$(e).show(),animateCSS(e,t,function(e){r.emit()})},toggle:function(t,n){$(e).is(":hidden")?this.expand(t):this.collapse(n)},list:{setTitle:function(e){$(n).text(e)},addItemToList:function(e){var e=$("<div>"+e+"</div>").addClass("default").appendTo(i);animateCSS(e,"fadeIn")},removeListItem:function(e){$(i).find("div").each(function(t,n){n=$(n),n.text()===e&&animateCSS(n,"fadeOut",function(e){e.remove()})})},addItemsToList:function(e){for(var t=0;t<e.length;t++)this.addItemToList(e[t])},emptyList:function(){$(i).empty()},listType:a},onCollapseEnd:{addListener:o.addListener,removeListener:o.removeListener,removeAllListenerse:o.removeAllListenerse},onExpandEnd:{addListener:r.addListener,removeListener:r.removeListener,removeAllListenerse:r.removeAllListenerse}}}function Shell(e,t){function n(e){r.val(e),setTimeout(function(){r[0].selectionStart=r[0].selectionEnd=e.length})}function i(e){return e.val()}function o(e){e.val("")}var r=$(e),a=new InputVault(100),s=new CustEvent;return $(t).perfectScrollbar({wheelSpeed:1,suppressScrollX:!0}),r.data("flag",!0),r.keypress(function(e){if(13===e.which){$(this).data("flag",!1),$(this).attr("rows",1);var t=i(r);a.addRecord(t),s.emit(t)}else $(this).data("flag",!0)}),r.on("input",function(){$(this).data("flag")?($(this).attr("rows",1),$(this).attr("rows",Math.ceil(($(this).prop("scrollHeight")-$(this).outerHeight())/$(this).height())+1)):($(this).data("flag",!0),o(r))}),r.keydown(function(e){var t=event.keyCode;38===t&&n(a.getRecord(!0)),40===t&&n(a.getRecord(!1))}),{in:{onSubmit:s.addListener,unbindSubmit:s.removeListener,unbindAllSubmit:s.removeAllListeners},out:new TextFormatter(t)}}function CommandHandler(e,t,n){function i(e){switch(e.label){case"help":a.out.printHighlight("Command list",a.out.type.SYSTEM),a.out.printLines(["/join --name (value) /* Join an existing room */","/leave /* Leave an existing room */","/motd /* Show the room's message of the day */","/create --name (value) ?--password (value) ?--motd (value) /* Create a new room */","/update --name (value) ?--password (value) ?--motd (value) /* Update an existing room */","/delete --name (value) /* Delete an existing room */"],a.out.type.SYSTEM);break;default:"message"===e.type?(t.out.printEmptyLine(),a.out.printLine("You cannot send messages, while offline.",a.out.type.ERROR),t.out.printEmptyLine()):(t.out.printEmptyLine(),a.out.printLine("This command is not available, while offline.",a.out.type.ERROR),t.out.printEmptyLine())}}function o(){r.onMessage.addListener(function(e){switch(e.label){case"message":if("html"===e.format)a.out.printRaw(e.parameters.markup);else{var n=new Date(e.timestamp).format("h:MM:ss TT",new Date),i=e.parameters.alias,o=e.parameters.content,l=e.parameters.color,u="["+n+"]:<"+i+"> "+o;a.out.printLine(u,l)}break;case"join":if("response"===e.type){r.session.room=e.parameters.roomName;var u="Welcome to "+e.parameters.roomName+"!",d=e.parameters.roomMotd,m=e.parameters.messageLog;r.transmitPacket(r.createRequest("users",{})),d&&(u=u+" MOTD: "+d),a.out.printHighlight(u,a.out.type.SYSTEM);for(var c=m.length-1;c>=0;c--){var o=m[c].content,n=new Date(m[c].timestamp).format("h:MM:ss TT",new Date),i=m[c].alias;u="["+n+"]:<"+i+"> "+o,a.out.printLine(u,a.out.type.DEFAULT)}}else"broadcast"===e.type&&(t.out.printEmptyLine(),a.out.printLine(e.parameters.alias+" has joined the room.",a.out.type.SYSTEM),t.out.printEmptyLine(),1===s.list.listType&&s.list.addItemToList(e.parameters.alias));break;case"leave":"response"===e.type?(r.session.room=null,t.out.printEmptyLine(),a.out.printLine('You have left room "'+e.parameters.roomName+'".',a.out.type.SYSTEM),t.out.printEmptyLine(),r.transmitPacket(r.createRequest("list",{}))):"broadcast"===e.type&&(a.out.printLine(e.parameters.alias+" has left the room.",a.out.type.SYSTEM),1===s.list.listType&&s.list.removeListItem(e.parameters.alias));break;case"list":var p=e.parameters.roomList;s.list.setTitle("Room list"),p.length>0&&(s.list.emptyList(),s.list.listType=0,s.list.addItemsToList(p));break;case"users":var v=e.parameters.userList;s.list.setTitle("User list"),v.length>0&&(s.list.emptyList(),s.list.listType=1,s.list.addItemsToList(v));break;case"create":var f=e.parameters.roomName,h=e.parameters.roomPassword,L=e.parameters.roomMotd;h||(h="none"),L||(L="none");var u="Room created! Name: "+f+", Password: "+h+", Message of the day: "+L;r.session.room||a.out.printHighlight(u,a.out.type.SUCCESS),0===s.list.listType&&s.list.addItemToList(f);break;case"update":var f=e.parameters.roomName,h=e.parameters.roomPassword,L=e.parameters.roomMotd;h||(h="none"),L||(L="none");var u="Password: "+h+", Message of the day: "+L;"response"===e.type?a.out.printHighlight("Room "+f+" updated! "+u,a.out.type.SUCCESS):"broadcast"===e.type&&a.out.printHighlight("Room updated! "+u,a.out.type.SYSTEM);break;case"delete":var S=e.parameters.roomName,w=e.parameters.current;"response"===e.type?(t.out.printEmptyLine(),a.out.printLine('Room "'+S+'" has been deleted.',a.out.type.SUCCESS),t.out.printEmptyLine(),w&&(t.out.printEmptyLine(),a.out.printLine('You have been removed from room "'+S+'".',a.out.type.WARNING),t.out.printEmptyLine())):"broadcast"===e.type&&S===r.session.room&&(r.transmitPacket(r.createRequest("list",{})),t.out.printEmptyLine(),a.out.printLine('Room "'+S+'" has been deleted.',a.out.type.WARNING),t.out.printEmptyLine(),a.out.printLine('You have been removed from room "'+S+'".',a.out.type.WARNING),t.out.printEmptyLine()),0===s.list.listType&&s.list.removeListItem(S);break;case"motd":var d=e.parameters.roomMotd;d?a.out.printHighlight("MOTD: "+d,a.out.type.SYSTEM):(t.out.printEmptyLine(),a.out.printLine("MOTD unavailable.",a.out.type.WARNING),t.out.printEmptyLine());break;case"ioerror":t.out.printEmptyLine(),a.out.printLine(e.parameters.error,a.out.type.ERROR),t.out.printEmptyLine()}})}var r=e,a=t,s=n;return{offlineHandler:i,responseHandler:o}}var TextFormatter=function(e,t){function n(e){var t=$("<div></div>").html(e).appendTo(v);animateCSS(t,"fadeIn")}function i(e,t){var n=$("<div></div>").html($("<pre></pre>").addClass("shell__output-line").text(e)).css("color",t).appendTo(v);animateCSS(n,"fadeIn")}function o(e,t,n){var i=$("<div><pre>"+Array(t+1).join(e)+"</pre></div>").css("color",n).appendTo(v);animateCSS(i,"fadeIn")}function r(e,t){var n=$("<div><pre>"+d+Array(m+1).join(" ")+Array(e-(2*m+1)).join(" ")+Array(m+1).join(" ")+d+"</pre></div>").css("color",t).appendTo(v);animateCSS(n,"fadeIn")}function a(e,t){var n=L-e.length,i=$("<div><pre>"+d+Array(m+1).join(" ")+e+Array(m+n+1).join(" ")+d+"</pre></div>").css("color",t).appendTo(v);animateCSS(i,"fadeIn")}function s(e,t){if(e.length>L){var n=e.slice(0,L),i=e.slice(L,L.length);a(n,t),s(i,t)}else a(e,t)}function l(){v.scrollTop(v.prop("scrollHeight")),v.perfectScrollbar("update")}t=t||{};const u=t.SYMBOL_TOP_BORDER||"=",d=t.SYMBOL_SIDE_BORDER||"|",m=(t.PADDING_TOP||1,t.PADDING_SIDE||1),c=t.SAMPLE_SELECTOR||".shell__sample";var p=$(c).width(),v=($(c).height(),$(e)),f=v.height()<v.width()?v.height():v.width(),h=Math.floor(f/p),L=h-2*(d.length+m);return{printRaw:function(e,t){n(e,t),l()},printLine:function(e,t){i(e,t),l()},printLines:function(e,t){for(var n=0;n<e.length;n++)i(e[n],t);l()},printEmptyLine:function(){o(" ",h),l()},printHighlight:function(e,t){o(" ",h,t),o(u,h,t),r(h,t),s(e,t),r(h,t),o(u,h,t),o(" ",h,t),l()},type:{DEFAULT:"#EEEEEE",SUCCESS:"#5CFF73",WARNING:"#FF8143",ERROR:"#FF5750",SYSTEM:"#42FFCF"}}},SocketClient=function(){function e(e,t,n,i,o){var r={};if(r.timestamp=e?(new Date).valueOf():null,!t)throw new Error("Uncaught Icp Error: type is not defined");return r.type=t,r.format=n||"text",r.label=i||null,r.parameters=o,r}var t=null,n=new CustEvent,i=new CustEvent,o=new CustEvent,r=new CustEvent,a=new CustEvent,s=new CustEvent;return{isConnected:function(e,n){setTimeout(function(){t&&t.connected?e():n()},0)},transmitPacket:function(e,n){t.emit("icp",e,n)},establishConnection:function(e){return t&&t.connected?t.emit("authentication",e):(t=io.connect("188.166.160.74:3000"),this.session=t.session=t.session||{},t.on("connect",function(){t.emit("authentication",e),o.emit()}),t.on("authenticated",function(e){n.emit(e)}),t.on("unauthorized",function(e){i.emit(e)}),t.on("disconnect",function(){r.emit()}),t.on("reconnect",function(){a.emit()}),void t.on("icp",function(e){s.emit(e)}))},createRequest:function(t,n){return e(!0,"request","text",t,n)},disconnect:function(){t&&t.connected&&t.disconnect()},onAuthSuccess:{addListener:n.addListener,removeListener:n.removeListener,removeAllListenerse:n.removeAllListenerse},onAuthFailure:{addListener:i.addListener,removeListener:i.removeListener,removeAllListenerse:i.removeAllListenerse},onConnect:{addListener:o.addListener,removeListener:o.removeListener,removeAllListenerse:o.removeAllListenerse},onDisconnect:{addListener:r.addListener,removeListener:r.removeListener,removeAllListenerse:r.removeAllListenerse},onReconnect:{addListener:a.addListener,removeListener:a.removeListener,removeAllListenerse:a.removeAllListenerse},onMessage:{addListener:s.addListener,removeListener:s.removeListener,removeAllListenerse:s.removeAllListenerse}}};$(window).ready(function(){var e={create:{isOnline:!0,validArgs:[{name:"name",required:!0},{name:"password",required:!1},{name:"motd",required:!1}]},delete:{isOnline:!0,validArgs:[{name:"name",required:!0}]},update:{isOnline:!0,validArgs:[{name:"name",required:!0},{name:"password",required:!1},{name:"motd",required:!1}]},join:{isOnline:!0,validArgs:[{name:"name",required:!0},{name:"password",required:!1}]},leave:{isOnline:!0,validArgs:[]},motd:{isOnline:!0,validArgs:[]},help:{isOnline:!1,validArgs:[]}},t=992,n=1200,i=(new ichatLogo(".logo"),new BlinkCursor(".logo__text")),o=new ichatuForm("#registration_form"),r=new ichatuForm("#login_form"),a=new ichatuFold("#intro"),s=new ichatuFold("#action"),l=window.statusbar=new ichatuStatusbar(".statusbar"),u=window.sidebar=new ichatuSidebar(".sidebar"),d=new Shell("#shell_input","#shell_output"),m=new Interpreter({COMMAND_PREFIX:"/",ARGUMENT_PREFIX:"--"}),c=new SocketClient,p=new CommandHandler(c,d,u);i.start();var v=new SectionSwitch("#action",{itemSelec:"section"});$("#register").click(function(){v.switch("#switch2","rotateOut","rotateIn")}),$(".login").click(function(){v.switch("#switch1","rotateOut","rotateIn")}),o.onCancel.addListener(function(){v.switch("#switch0","rotateOut","rotateIn")}),o.onSubmit.addListener(function(e){$.ajax("/register",{success:function(e){e.success===!0?v.switch("#switch3","rotateOut","rotateIn"):e.error?o.setValidationText(e.error):o.setValidationText("Unexpected error")},error:function(e){o.setValidationText("Unexpected error")},type:"POST",data:e.data})}),r.onSubmit.addListener(function(e){c.establishConnection(c.createRequest("login",e.data))}),c.onConnect.addListener(function(){l.statusOn()}),c.onReconnect.addListener(function(){d.out.printLine("CONNECTION RESTORED",d.out.type.SUCCESS),c.transmitPacket(c.createRequest("list",{}))}),c.onDisconnect.addListener(function(){l.statusOff(),u.list.setTitle("Unavailable"),u.list.emptyList(),c.session.room&&(d.out.printEmptyLine(),d.out.printLine('You have been removed from room "'+c.session.room+'".',d.out.type.ERROR),d.out.printEmptyLine()),d.out.printEmptyLine(),d.out.printLine("CONNECTION TERMINATED",d.out.type.ERROR),d.out.printEmptyLine()}),c.onAuthSuccess.addListener(function(e){r.setValidationText(""),c.transmitPacket(c.createRequest("list",{})),$(window).width()>t?(a.collapse("slideOutLeft"),s.collapse("slideOutRight")):(a.collapse("slideOutUp"),s.collapse("slideOutDown"))}),a.onCollapseEnd.addListener(function(){l.expand("slideInDown")}),s.onCollapseEnd.addListener(function(){$(".shell__input").show(),animateCSS(".shell__input","slideInUp",function(){d.out.printHighlight("WELCOME TO ICHATU !!!",d.out.type.SUCCESS),d.out.printHighlight("Please note that this is, only a prototype and bugs may occur!",d.out.type.WARNING),d.out.printHighlight("COMMAND LIST",d.out.type.SYSTEM),d.out.printLines(["/join --name (value) /* Join an existing room */","/leave /* Leave an existing room */","/motd /* Show the room's message of the day */","/create --name (value) ?--password (value) ?--motd (value) /* Create a new room */","/update --name (value) ?--password (value) ?--motd (value) /* Update an existing room */","/delete --name (value) /* Delete an existing room */"],d.out.type.SYSTEM),d.out.printEmptyLine(),$(window).width()>n&&u.expand("slideInRight")})}),c.onAuthFailure.addListener(function(e){r.setValidationText(e.parameters.error)}),r.onCancel.addListener(function(){v.switch("#switch0","rotateOut","rotateIn"),r.setValidationText("")}),l.infoBtn.click(function(){u.toggle("slideInRight","slideOutRight")}),d.in.onSubmit(function(t){m.interpret(t,e,function(e,t,n){var i=c.createRequest(e,t);c.isConnected(function(){n?c.transmitPacket(i,function(e){var t=new Date(i.timestamp).format("h:MM:ss TT",new Date),n=i.parameters.content,o="["+t+"]:<You> "+n;200===e.parameters.status&&d.out.printLine(o,d.out.type.DEFAULT)}):p.offlineHandler(i)},function(){p.offlineHandler(i)})},function(e){d.out.printEmptyLine(),d.out.printLine(e,d.out.type.ERROR),d.out.printEmptyLine()})}),p.responseHandler()});